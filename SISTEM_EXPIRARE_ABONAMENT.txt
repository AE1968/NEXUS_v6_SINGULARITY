â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                           â•‘
â•‘   SISTEM EXPIRARE ABONAMENT - DOCUMENTAÈšIE                â•‘
â•‘                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… DATA: 2025-12-21 22:54
â° SISTEM: Auto-expirare + NotificÄƒri

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ CERINÈšE:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. â° Notificare cu 3 ZILE Ã®nainte de expirare
2. ğŸ”’ Deconectare AUTOMATÄ‚ la expirare (fÄƒrÄƒ platÄƒ)
3. âœ… Reconectare AUTOMATÄ‚ la confirmare platÄƒ nouÄƒ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š STRUCTURÄ‚ DATE UTILIZATOR:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

USERS_DB['john_doe'] = {
    username: 'john_doe',
    email: 'john@example.com',
    password: 'hashed_password',
    role: 'user',
    
    subscription: {
        planId: '6_months',
        planName: '6 Months Plan',
        subscriptionId: 'I-PAYPAL-SUB-12345',
        status: 'active',  // 'active', 'expiring_soon', 'expired', 'cancelled'
        
        // Dates
        startDate: '2024-12-21T10:00:00Z',
        endDate: '2025-06-21T10:00:00Z',
        
        // Pricing
        pricePerMonth: 5.00,
        totalPrice: 30.00,
        currency: 'GBP',
        
        // Notifications
        notifiedAt3Days: false,  // A fost notificat?
        lastNotificationDate: null,
        
        // Payment
        paymentMethod: 'paypal',
        lastPaymentDate: '2024-12-21T10:00:00Z',
        nextBillingDate: null,
        autoRenew: false
    },
    
    permissions: ['view', 'chat', 'voice'],
    chatHistory: [],
    settings: { language: 'en', voiceEnabled: true },
    stats: { totalLogins: 0, totalMessages: 0 }
};

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â° LOGICA VERIFICARE:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

function checkSubscriptionStatus(username) {
    const user = USERS_DB[username];
    if (!user || !user.subscription) return;
    
    const now = new Date();
    const endDate = new Date(user.subscription.endDate);
    const daysUntilExpiry = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
    
    // CAZ 1: Abonament EXPIRAT
    if (now >= endDate) {
        if (user.subscription.status !== 'expired') {
            console.log(`â° Subscription EXPIRED for ${username}`);
            user.subscription.status = 'expired';
            user.permissions = ['view'];  // Downgrade to view-only
            
            // Deconectare automatÄƒ
            if (localStorage.getItem('nexus_current_user') === username) {
                alert('Your subscription has expired. Please renew to continue using the service.');
                window.logout();
            }
        }
        return 'expired';
    }
    
    // CAZ 2: 3 ZILE pÃ¢nÄƒ la expirare
    if (daysUntilExpiry <= 3 && !user.subscription.notifiedAt3Days) {
        console.log(`âš ï¸  Subscription expiring in ${daysUntilExpiry} days for ${username}`);
        user.subscription.status = 'expiring_soon';
        user.subscription.notifiedAt3Days = true;
        user.subscription.lastNotificationDate = now.toISOString();
        
        // Notificare politicoasÄƒ
        showExpiryNotification(username, daysUntilExpiry);
        
        return 'expiring_soon';
    }
    
    // CAZ 3: Abonament ACTIV
    return 'active';
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¬ NOTIFICARE 3 ZILE:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

function showExpiryNotification(username, daysLeft) {
    const user = USERS_DB[username];
    const planName = user.subscription.planName;
    const endDate = new Date(user.subscription.endDate);
    const formattedDate = endDate.toLocaleDateString('en-GB', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    });
    
    // Mesaj politicos
    const message = `
        Dear ${username},
        
        Your ${planName} subscription will expire in ${daysLeft} day${daysLeft > 1 ? 's' : ''}.
        
        Expiry Date: ${formattedDate}
        
        To continue enjoying uninterrupted access to all features, 
        please renew your subscription before it expires.
        
        Thank you for being a valued member!
    `;
    
    // AfiÈ™are notificare
    showNotificationModal(message, 'warning');
    
    // Log
    console.log(`ğŸ“§ Expiry notification sent to ${username}`);
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”’ DECONECTARE LA EXPIRARE:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

function handleSubscriptionExpiry(username) {
    const user = USERS_DB[username];
    
    // SchimbÄƒ status
    user.subscription.status = 'expired';
    
    // Downgrade permisiuni
    user.permissions = ['view'];  // Doar vizualizare
    
    // SalveazÄƒ Ã®n DB
    saveUserData(username);
    
    // DacÄƒ user este logat, deconecteazÄƒ-l
    const currentUser = localStorage.getItem('nexus_current_user');
    if (currentUser === username) {
        // Mesaj politicos
        const message = `
            Your subscription has expired.
            
            You have been logged out automatically.
            
            To continue using our service, please renew your subscription.
            
            Thank you for your understanding!
        `;
        
        alert(message);
        
        // Logout automat
        window.logout();
    }
    
    console.log(`ğŸ”’ User ${username} logged out due to subscription expiry`);
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… RECONECTARE LA PLATÄ‚ NOUÄ‚:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

// Webhook PayPal (Backend)
@app.route('/api/paypal/webhook', methods=['POST'])
def paypal_webhook():
    data = request.json
    event_type = data.get('event_type')
    
    if event_type == 'BILLING.SUBSCRIPTION.ACTIVATED':
        subscription_id = data['resource']['id']
        
        // GÄƒseÈ™te user-ul
        username = find_user_by_subscription_id(subscription_id)
        if username:
            user = USERS_DB[username]
            
            // ReactiveazÄƒ abonament
            user.subscription.status = 'active'
            user.subscription.startDate = datetime.now().isoformat()
            user.subscription.endDate = calculate_end_date(user.subscription.planId)
            user.subscription.notifiedAt3Days = False
            
            // RestabileÈ™te permisiuni
            user.permissions = get_permissions_for_plan(user.subscription.planId)
            
            // SalveazÄƒ
            save_user_data(username)
            
            // NotificÄƒ user-ul (dacÄƒ e online)
            notify_user_renewal_success(username)
            
            console.log(f"âœ… Subscription renewed for {username}")
    
    return jsonify({'status': 'received'}), 200

// Frontend - Notificare reconectare
function notify_user_renewal_success(username) {
    const currentUser = localStorage.getItem('nexus_current_user');
    
    if (currentUser === username) {
        // User este online - notificare instant
        const message = `
            Great news!
            
            Your subscription has been successfully renewed!
            
            You now have full access to all features again.
            
            Thank you for your continued support!
        `;
        
        showNotificationModal(message, 'success');
        
        // Refresh permisiuni
        location.reload();  // Sau update dinamic
    }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â±ï¸  VERIFICARE PERIODICÄ‚:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

// La fiecare LOGIN
function login(username, password) {
    // ... validare credenÈ›iale ...
    
    // VerificÄƒ status abonament
    const status = checkSubscriptionStatus(username);
    
    if (status === 'expired') {
        alert('Your subscription has expired. Please renew to login.');
        return false;
    }
    
    // ... continuÄƒ login ...
}

// Verificare periodicÄƒ (la fiecare 1 orÄƒ)
setInterval(() => {
    const currentUser = localStorage.getItem('nexus_current_user');
    if (currentUser) {
        checkSubscriptionStatus(currentUser);
    }
}, 60 * 60 * 1000); // 1 orÄƒ

// Verificare la fiecare acÈ›iune importantÄƒ
function sendMessage(message) {
    const currentUser = localStorage.getItem('nexus_current_user');
    const status = checkSubscriptionStatus(currentUser);
    
    if (status === 'expired') {
        alert('Your subscription has expired. Please renew to continue.');
        return false;
    }
    
    // ... trimite mesaj ...
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š STATUSURI ABONAMENT:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Status          | Descriere                    | AcÈ›iune
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
active          | Abonament activ              | Acces complet
expiring_soon   | 3 zile pÃ¢nÄƒ la expirare      | Notificare + Acces complet
expired         | Abonament expirat            | Logout + View only
cancelled       | Anulat de user               | Logout + View only
pending         | Ãn aÈ™teptare platÄƒ           | View only

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”„ FLUX COMPLET:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

SCENARIUL 1: Expirare fÄƒrÄƒ reÃ®nnoire
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ziua 1:   User plÄƒteÈ™te Â£30 pentru 6 luni
Ziua 177: (3 zile Ã®nainte) Notificare: "Expires in 3 days"
Ziua 178: (2 zile Ã®nainte) Reminder
Ziua 179: (1 zi Ã®nainte) Final reminder
Ziua 180: EXPIRARE
          - Status â†’ 'expired'
          - Permissions â†’ ['view']
          - DacÄƒ e logat â†’ Logout automat
          - Alert: "Subscription expired"

SCENARIUL 2: ReÃ®nnoire Ã®nainte de expirare
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ziua 177: Notificare: "Expires in 3 days"
Ziua 178: User plÄƒteÈ™te pentru reÃ®nnoire
          - PayPal webhook â†’ Backend
          - Status â†’ 'active'
          - EndDate â†’ +6 luni
          - notifiedAt3Days â†’ false
          - Notificare: "Successfully renewed!"
          - DacÄƒ e logat â†’ Refresh automat

SCENARIUL 3: ReÃ®nnoire dupÄƒ expirare
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ziua 180: Expirare â†’ Logout
Ziua 185: User vrea sÄƒ se logheze
          - Login blocat: "Subscription expired"
          - OpÈ›iune: "Renew Now"
          - User plÄƒteÈ™te
          - PayPal confirmÄƒ
          - Status â†’ 'active'
          - Permissions restaurate
          - Login permis
          - Notificare: "Welcome back!"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… REZUMAT:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… Notificare la 3 zile Ã®nainte (politicoasÄƒ)
âœ… Deconectare automatÄƒ la expirare (fÄƒrÄƒ platÄƒ)
âœ… Reconectare automatÄƒ la confirmare platÄƒ nouÄƒ
âœ… Verificare periodicÄƒ (la login + la fiecare orÄƒ)
âœ… Mesaje politicoase pentru user
âœ… Downgrade la view-only la expirare
âœ… Restaurare completÄƒ la reÃ®nnoire

GATA DE IMPLEMENTARE! ğŸš€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ VERSIUNE: v4.3 - SUBSCRIPTION EXPIRY SYSTEM
ğŸ“… DATA: 2025-12-21 22:54
â° STATUS: DOCUMENTAT

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
